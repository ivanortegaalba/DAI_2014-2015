# -*- encoding: utf-8 -*-

import web
from web import form
from web.contrib.template import render_mako

render = web.template.render('templates/')

urls = ('/', 'index',
		'/pagina1', 'pagina1',
		'/pagina2', 'pagina2',
        '/pagina3', 'pagina3'
		'/pagina4', 'pagina4')

app = web.application(urls, locals())

makos = render_mako(
		directories=['templates'],
		input_encoding='utf-8',
		output_encoding='utf-8',
		encoding_errors='replace'
		)

login = form.Form(
	form.Textbox('Usuario', class_="form-control"),
	form.Password('Contrasena', class_="form-control"),
	form.Checkbox('Recuerdame', 
				  form.Validator("No has aceptado las condiciones", lambda i: i == 'true'), 
				  value='true'),
	form.Button('Entrar', _class="button btn-default"))

logout = "<a href='/'>Salir</a>"

contentbody= "En un lugar de la Mancha, de cuyo nombre no quiero acordarme, no ha mucho tiempo que vivia un hidalgo de los de lanza en astillero, adarga antigua, rocin flaco y galgo corredor."

sesion = web.session.Session(app, web.session.DiskStore('sesiones'))

def ultimas():
    return"\
			<li>"+str(sesion.pag1)+"</li> \
			<li>"+str(sesion.pag2)+"</li> \
			<li>" + str(sesion.pag3) +"</li>"

class index:
	def GET(self):
		if 'user' not in sesion:
			loginForm=login();
			return makos.mako_template(titulo = "Inicio", form = login)
		else:
			sesion.pag3 = sesion.pag2
			sesion.pag2 = sesion.pag1
			sesion.pag1 = "Inicio";
			return makos.mako_template(titulo = "Inicio", ultimas = ultimas(), content = contentbody)

	def POST(self):
		loginForm = login()
		if not loginForm.validates():
			return makos.mako_template(form = loginForm)		
		else:
			input_t = web.input()
			user = input_t.Usuario
			sesion.user = user
			sesion.pag1 = "null"
			sesion.pag2 = "null"
			sesion.pag3 = "null"
			return makos.mako_template(header = "Inicio", message = "Bienvenido %s!  <a class = 'button' href='/'>Salir</a>" % (sesion.user))

class pagina1:
	def GET(self):
		if 'user' not in sesion:
			loginForm=login();
			return makos.mako_template(header = "Página 2", form = login)
			sesion.pag3 = sesion.pag2
			sesion.pag2 = sesion.pag1
			sesion.pag1 = "Página 1"
			return makos.mako_template(header = "Página 1",ultimas = ultimas())
		
	def POST(self):
		loginForm = login()
		if not loginForm.validates():
			return makos.mako_template(form = loginForm)		
		else:
			input_t = web.input()
			user = input_t.Usuario
			sesion.user = user
			sesion.pag1 = "null"
			sesion.pag2 = "null"
			sesion.pag3 = "null"
			return makos.mako_template(header = "Página 1", message = "Bienvenido %s!  <a class = 'button' href='/'>Salir</a>" % (sesion.user))

class pagina2:
	def GET(self):
		if 'user' not in sesion:
			loginForm=login();
			return makos.mako_template(header = "Página 2", form = login)
		else:
			sesion.pag3 = sesion.pag2
			sesion.pag2 = sesion.pag1
			sesion.pag1 = "Página 2"
			return makos.mako_template(header = "Página 2",ultimas = ultimas())
		
	def POST(self):
		loginForm = login()
		if not loginForm.validates():
			return makos.mako_template(form = loginForm)		
		else:
			input_t = web.input()
			user = input_t.Usuario
			sesion.user = user
			sesion.pag1 = "null"
			sesion.pag2 = "null"
			sesion.pag3 = "null"
			return makos.mako_template(header = "Página 2", message = "Bienvenido %s!  <a class = 'button' href='/'>Salir</a>" % (sesion.user))

class pagina3:
	def GET(self):
		if 'user' not in sesion:
			loginForm=login();
			return makos.mako_template(header = "Página 3", form = login)
		else:
			sesion.pag3 = sesion.pag2
			sesion.pag2 = sesion.pag1
			sesion.pag1 = "Página 3"
			return makos.mako_template(header = "Página 3",ultimas = ultimas())
		
	def POST(self):
		loginForm = login()
		if not loginForm.validates():
			return makos.mako_template(form = loginForm)		
		else:
			input_t = web.input()
			user = input_t.Usuario
			sesion.user = user
			sesion.pag1 = "null"
			sesion.pag2 = "null"
			sesion.pag3 = "null"
			return makos.mako_template(header = "Página 3", message = "Bienvenido %s!  <a class = 'button' href='/'>Salir</a>" % (sesion.user))

class pagina4:
	def GET(self):
		if 'user' not in sesion:
			loginForm=login();
			return makos.mako_template(header = "Página 4", form = login)
		else:
			sesion.pag3 = sesion.pag2
			sesion.pag2 = sesion.pag1
			sesion.pag1 = "Página 4"
			return makos.mako_template(header = "Página 4", ultimas = ultimas())
		
	def POST(self):
		loginForm = login()
		if not loginForm.validates():
			return makos.mako_template(form = loginForm)		
		else:
			input_t = web.input()
			user = input_t.Usuario
			sesion.user = user
			sesion.pag1 = "null"
			sesion.pag2 = "null"
			sesion.pag3 = "null"
			return makos.mako_template(header = "Página 4", message = "Bienvenido %s!  <a class = 'button' href='/'>Salir</a>" % (sesion.user))


if __name__=="__main__":
	web.internalerror = web.debugerror
	app.run()
